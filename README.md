# FromtmostEffectOnOverlayScreen
unityでoverlayのキャンバスにパーティクルエフェクトを表示させるアセット。

# デモ
UniRxを使って実装しているので、AssetStoreからUniRxのアセットをインポートしましょう。
EffectManagerプレハブをシーンに追加し、
エフェクトを表示させたいCanvasオブジェクトをEffectManagerオブジェクトのインスペクターにあるMostFrontCanvas変数にアタッチすれば準備完了です。
再生すると、とクリックした位置から桜が散るエフェクトが再生されるデモを体験できます。

# 経緯と仕組み
## 経緯
通常Canvas上にパーティクルエフェクトを表示したい場合、CanvasのRenderModeをScreen Space - CameraにしてカメラとCanvasの間にパーティクルを生成する手法を考えると思います。<br>
この方法だと不都合が起きる可能性がある場合があると思います。
例えば、関係ないオブジェクトがCanvasとカメラの間を横切ったりするとCanvasがオブジェクトで隠れてしまいCanvas上のオブジェクトが見えなくなってしまうなどです。<br>
CanvasのRenderModeをScreen Space - Overlayにした状態でパーティクルエフェクトを画面の最前面に表示させる方法が欲しい時の為に手法を考え実装しました。

## 仕組み
メインカメラとは別にカメラを用意し表示させたいパーティクルエフェクトを写します。<br>
このカメラに映った映像をRenderTextureに描画し、Canvas上にrwaImageを生成しそのRenderTextureをテクスチャとしてセットする事でパーティクルを画面最前面に表示させています。<br>



# 改変したい場合
EffectCaptureSetプレハブが上記のカメラとパーティクルオブジェクトを子要素に持っています。<br>
エフェクト自体を変えたい場合はこのプレハブ内のパーティクルを編集すればそのまま反映されます。<br>
<br>
EffectRawImageプレハブが上記のCanvas上に置かれるrawImageのオブジェクトです。エフェクトの表示領域を変えたい場合などはこのプレハブを編集しましょう。<br>
<br>
デモはおおよそクリックした位置にエフェクトが表示されるようにしてありますが、これはEffectSetクラスのPlayOn()メソッドで定義されてるので再生位置を変えたい場合などこここを編集して下さい。<br>


# おまけ
エフェクトを扱う想定で作っているのでEffectManagerクラスにオブジェクトプール機能を実装してあります。<br>
常にプールするエフェクトの数などもEffectManagerプレハブのインスペクターから編集できるようにしてあります。<br>

# 備考
- デモを実行した限りではFPSに大きな変化はなかったので問題ないとは思いますが、一つのエフェクトを表示させる為に、パーティクル、カメラ、rawImageの3つのオブジェクトが生成される為、パーティクルエフェクトだけを生成する場合より負荷がかかるはずです。<br>
- パーティクルエフェクトをカメラの視錐台内に収める必要があるのでパーティクルの設定やカメラの位置の調整などが面倒になります。<br>
- 同様にrawImageのサイズを変えたりするとパーティクルやカメラの設定を変えない写りが変わってしまうと思うのでその辺りの調整が面倒になります。<br>
- この手法を使いたい場合は好きに使って下さい。一報貰えると僕が喜びます。アドバイスなども貰えると喜ぶと思います。<br>
